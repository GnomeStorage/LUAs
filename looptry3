local player = game.Players.LocalPlayer
local gui = player:WaitForChild("PlayerGui")

-- Cleanup old GUI
if gui:FindFirstChild("FakeDisconnectUI") then
    gui.FakeDisconnectUI:Destroy()
end

local screenGui = Instance.new("ScreenGui")
screenGui.Name = "FakeDisconnectUI"
screenGui.IgnoreGuiInset = true
screenGui.ResetOnSpawn = false
screenGui.Parent = gui

-- Fullscreen invisible button blocking all input behind modal
local blocker = Instance.new("TextButton")
blocker.Size = UDim2.new(1, 0, 1, 0)
blocker.Position = UDim2.new(0, 0, 0, 0)
blocker.BackgroundTransparency = 1
blocker.Text = ""
blocker.AutoButtonColor = false
blocker.Active = true
blocker.Modal = true
blocker.ZIndex = 1000
blocker.Parent = screenGui

-- Dark transparent overlay
local overlay = Instance.new("Frame")
overlay.Size = UDim2.new(1, 0, 1, 0)
overlay.Position = UDim2.new(0, 0, 0, 0)
overlay.BackgroundColor3 = Color3.new(0, 0, 0)
overlay.BackgroundTransparency = 0.55
overlay.ZIndex = 1001
overlay.Parent = screenGui

-- Modal frame function (for reuse)
local function createModal(text)
    local modal = Instance.new("Frame")
    modal.Size = UDim2.new(0.5, 0, 0.3, 0)
    modal.Position = UDim2.new(0.25, 0, 0.35, 0)
    modal.BackgroundColor3 = Color3.fromRGB(35,35,35)
    modal.ZIndex = 1002
    modal.Parent = screenGui

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1, -20, 0.55, 0)
    label.Position = UDim2.new(0, 10, 0, 20)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1,1,1)
    label.Font = Enum.Font.SourceSansBold
    label.TextScaled = true
    label.TextWrapped = true
    label.Text = text
    label.ZIndex = 1003
    label.Parent = modal

    local yes = Instance.new("TextButton")
    yes.Size = UDim2.new(0.45, 0, 0.25, 0)
    yes.Position = UDim2.new(0.05, 0, 0.75, 0)
    yes.Text = "Yes"
    yes.BackgroundColor3 = Color3.fromRGB(220,220,220)
    yes.TextColor3 = Color3.new(0,0,0)
    yes.Font = Enum.Font.SourceSansBold
    yes.TextScaled = true
    yes.ZIndex = 1003
    yes.Parent = modal

    local no = Instance.new("TextButton")
    no.Size = UDim2.new(0.45, 0, 0.25, 0)
    no.Position = UDim2.new(0.5, 0, 0.75, 0)
    no.Text = "No"
    no.BackgroundColor3 = Color3.fromRGB(60,60,60)
    no.TextColor3 = Color3.new(1,1,1)
    no.Font = Enum.Font.SourceSansBold
    no.TextScaled = true
    no.ZIndex = 1003
    no.Parent = modal

    return modal, yes, no
end

-- Spinner frame for injecting
local function createSpinner()
    local frame = Instance.new("Frame")
    frame.Size = UDim2.new(0.5, 0, 0.15, 0)
    frame.Position = UDim2.new(0.25, 0, 0.425, 0)
    frame.BackgroundColor3 = Color3.fromRGB(35,35,35)
    frame.ZIndex = 1002
    frame.Parent = screenGui

    local label = Instance.new("TextLabel")
    label.Size = UDim2.new(1,0,1,0)
    label.BackgroundTransparency = 1
    label.TextColor3 = Color3.new(1,1,1)
    label.Font = Enum.Font.SourceSansBold
    label.TextScaled = true
    label.Text = "Injecting script..."
    label.ZIndex = 1003
    label.Parent = frame

    local spinner = Instance.new("ImageLabel")
    spinner.Size = UDim2.new(0,40,0,40)
    spinner.Position = UDim2.new(0.5, -20, 1, -50)
    spinner.BackgroundTransparency = 1
    spinner.Image = "rbxassetid://10493257496" -- Spinner asset
    spinner.ZIndex = 1003
    spinner.Parent = frame

    -- Spin logic
    local spinning = true
    spawn(function()
        while spinning do
            spinner.Rotation = spinner.Rotation + 10
            wait(0.03)
        end
    end)

    return frame, function() spinning = false end
end

-- Main reconnect loop
local reconnectMessages = {
    "Failed to inject script. Want to try again?",
    "Slow internet connection. Want to reconnect?"
}

local function reconnectLoop()
    -- Show spinner
    local spinnerFrame, stopSpin = createSpinner()
    wait(5)
    stopSpin()
    spinnerFrame:Destroy()

    local function promptReconnect()
        local message = reconnectMessages[math.random(1, #reconnectMessages)]
        local modal, yes, no = createModal(message)

        yes.MouseButton1Click:Connect(function()
            modal:Destroy()
            reconnectLoop()
        end)

        no.MouseButton1Click:Connect(function()
            -- Do nothing, keep modal open
        end)
    end

    promptReconnect()
end

-- Start initial prompt
local modal, yes, no = createModal("Would you like to inject scripts by BaconScripts?")

yes.MouseButton1Click:Connect(function()
    modal:Destroy()
    reconnectLoop()
end)

no.MouseButton1Click:Connect(function()
    -- Do nothing, modal stays open
end)
